<!DOCTYPE HTML>
<html>
<head>
<title>climber</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script type="text/javascript">var testEnv = false</script> 
<script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="js/jquery.mobile.js"></script>
<link rel="stylesheet" type="text/css" href="css/jquery.mobile.css" />
<link rel="stylesheet" type="text/css" href="css/jquery.mobile.structure.css" />
<link rel="stylesheet" type="text/css" href="css/jquery.mobile.theme.css" />
<script type="text/javascript" charset="utf-8" src="js/phonegap.js"></script>
<script type="text/javascript" charset="utf-8" src="js/predef.js"></script>

<!-- foreground camera for android background closing bug -->
<script type="text/javascript" src="js/camera.js"></script>

<!-- if android version <3.0 -->
<script type="text/javascript" charset="utf-8" src="js/todataurl.js"></script>

<!-- mapping apis -->
<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
<script type="text/javascript" src="js/jquery.ui.map/jquery.ui.map.js"></script>
<script type="text/javascript" src="js/jquery.ui.map/jquery.ui.map.services.js"></script>
<style>
.ui-page { // this gets rid of the flickering on page transitions on android 
    -webkit-backface-visibility: hidden;
}
</style>

<!--  setup climbing image, mapping, comm behaviour  -->
<script type="text/javascript" charset="utf-8" src="js/geo.js"></script>
<script type="text/javascript" charset="utf-8" src="js/climage.js"></script>
<script type="text/javascript" charset="utf-8" src="js/rest.js"></script>
<script type="text/javascript">
var currentClimage; 

function resetMap() {
	currentClimage.setAreaId(0)
	geo.updateLocation()
	geo.centreToLocation(currentClimage.latitude, currentClimage.longitude, currentClimage.globalZoom)
	geo.markSitesNear(currentClimage.latitude, currentClimage.longitude)
}
function newRoute() {
	if(currentClimage.areaId != 0) {
		currentClimage.takePhoto()		
	} else {
		alert('Please select area before adding route...')
	}
}

// stretch the map to the footer and eliminate padding
$(window).delegate('.content-adjust-no-padding', 'pageshow', function () {
	$(this).find('[data-role="content"]').css('padding','0px'); // override the padding for the content so things don't overflow
	var the_height = $(window).height() - $(this).find('[data-role="header"]').height() - $(this).find('[data-role="footer"]').height() -4
    $(this).height(the_height).find('[data-role="content"]').height(the_height)
	var the_width = $(window).width();
    $(this).width(the_width).find('[data-role="content"]').width(the_width);
});

$(window).delegate('#route', 'pageshow', function() {
	$('#grade').bind('change', function() {
		$('#gradeYDS').attr('value',currentClimage.gradings[0][$(this).val()]);
		$('#gradeBritish').attr('value',currentClimage.gradings[1][$(this).val()]);
	})
	$('#canvas').click(function(e) { 
		currentClimage.addRoutePoint(e.clientX-$("#canvas").offset().left, e.clientY-$("#canvas").offset().top); 
	})
// 	var canvasWidth = Math.min(640,$('#route').width()-parseInt($('#route').find('[data-role="content"]').css('padding-left'))-parseInt($('#route').find('[data-role="content"]').css('padding-right')))
// 	$('#canvas').width(canvasWidth); $('#canvas').height(canvasWidth*2/3)
})

var mapFirst = true
$(window).delegate('#map', 'pageshow', function() {
	if(mapFirst && currentClimage) {
		resetMap()
		mapFirst = false
	}
})

$(document).bind('deviceready',function() {
// $(document).bind('ready',function() {
	currentClimage = new Climage();
	$('#grade').attr('max',currentClimage.gradings[0].length)
	resetMap()
	
	currentClimage.setAreaId(1)
	currentClimage.takePhoto()
});
</script>


</head>
<body>


	<div data-role="page" id="home" class="content-adjust-for-padding">
		<div data-role="header" data-position="fixed">
			<div data-role="navbar">
				<ul>
					<li><a href="#home" class="ui-btn-active">Home</a></li>
					<li><a href="#map">Map</a></li>
					<li><a href="#route">Route</a></li>
				</ul>
			</div>
		</div>
		<div data-role="content">
			<p>VisionClimb</p>
			Tap an area in the map and create a new climbing route there.
		</div>
		<div data-role="footer" data-position="fixed" data-tap-toggle="false">
		</div>
	</div>


	<div data-role="page" id="map" class="content-adjust-no-padding">
		<div data-role="header" id="map-header" data-position="fixed">
			<div data-role="navbar">
				<ul>
					<li><a href="#home">Home</a></li>
					<li><a href="#map" class="ui-btn-active">Map</a></li>
					<li><a href="#route">Route</a></li>
				</ul>
			</div>		
		</div>
		<div data-role="content" id="map-square"></div>
		<div data-role="footer" id="map-footer" data-position="fixed" data-tap-toggle="false">
			<div data-role="navbar">
				<ul>
					<li><a onclick="resetMap()">Reset</a></li>
					<li><a onclick="newRoute()">New Route</a></li>
				</ul>
			</div>
		</div>		
	</div>


	<div data-role="page" id="route" class="content-adjust-for-padding">
		<div data-role="header" data-position="fixed">
			<div data-role="navbar">
				<ul>
					<li><a href="#home">Home</a></li>
					<li><a href="#map">Map</a></li>
					<li><a href="#route" class="ui-btn-active">Route</a></li>
				</ul>
			</div>		
		</div>
		<div data-role="content">
			<canvas id="canvas" style="border:1px solid black;" width="200" height="300"></canvas>
			<label for="areaId">Area ID:</label><input type="text" id="areaId" value="0" readonly="readonly" />
			<label for="latitude">Latitude:</label><input type="text" id="latitude" value="53" />
			<label for="longitude">Longitude:</label><input type="text" id="longitude" value="0" />
			<label for="routeName">Route name:</label><input type="text" id="routeName" value="a route" />
			<label for="grade">Grade:</label><input type="range" name="slider" id="grade" value="1" min="1" max="1" />
			<div class="ui-grid-a">
				<div class="ui-block-a"><label for="gradeYDS">YDS:</label><input id="gradeYDS" type="text" readonly="readonly" /></div>
				<div class="ui-block-b"><label for="gradeBritish">British:</label><input id="gradeBritish" type="text" readonly="readonly" /></div>
			</div>
		</div>
		<div data-role="footer" data-position="fixed" data-tap-toggle="false">
			<div data-role="navbar">
				<ul>
					<li><a onclick="currentClimage.save()">Save</a></li>
				</ul>
			</div>
		</div>		
	</div>

</body>
</html>
